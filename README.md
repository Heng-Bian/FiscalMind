# FiscalMind

é¢å‘è´¢åŠ¡BPçš„æ™ºèƒ½è¡¨æ ¼åˆ†æç³»ç»Ÿ - AI-Powered Table Analysis System for Financial Business Partners

## ç®€ä»‹ (Introduction)

FiscalMind æ˜¯åŸºäº LangGraph æ¡†æ¶çš„æ™ºèƒ½è´¢åŠ¡è¡¨æ ¼åˆ†æç³»ç»Ÿï¼Œé€šè¿‡æ·±åº¦é›†æˆå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œå®ç°ä»æ•°æ®è§£æåˆ°ä¸šåŠ¡ç†è§£çš„å…¨æµç¨‹æ™ºèƒ½åŒ–åˆ†æã€‚

FiscalMind is an AI-powered financial table analysis system built on LangGraph, achieving end-to-end intelligent analysis from data parsing to business understanding through deep LLM integration.

## æ ¸å¿ƒç‰¹æ€§ (Core Features)

### ğŸ¤– LLM é©±åŠ¨çš„ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›

#### 1. æ™ºèƒ½è¡¨å¤´è¯†åˆ«
**å¤§æ¨¡å‹è‡ªåŠ¨è¯†åˆ«è¡¨å¤´ç»“æ„**ï¼ŒåŒºåˆ†è¡¨å¤´è¡Œä¸æ•°æ®è¡Œï¼Œé¿å…è¯¯åˆ¤
- å‡†ç¡®å¤„ç†å¤šå±‚è¡¨å¤´ã€åˆå¹¶å•å…ƒæ ¼
- è‡ªé€‚åº”å„ç§è¡¨æ ¼æ ¼å¼å’Œåç§»ä½ç½®
- æä¾›ç½®ä¿¡åº¦è¯„åˆ†ï¼Œä½ç½®ä¿¡åº¦æ—¶è‡ªåŠ¨å›é€€

#### 2. è¯­ä¹‰å­—æ®µåŒ¹é…
**åŸºäºä¸šåŠ¡è¯­ä¹‰çš„æ™ºèƒ½å­—æ®µåŒ¹é…**ï¼Œç†è§£ä¸šåŠ¡å«ä¹‰è€Œéç®€å•å­—ç¬¦ä¸²æ¯”è¾ƒ
- åˆ—åæ™ºèƒ½åŒ¹é…ï¼š"è–ªèµ„" â†’ "æœˆè–ª"ã€"è¥æ”¶" â†’ "é”€å”®é¢"
- å·¥ä½œè¡¨åŒ¹é…ï¼š"24å¹´é¢„ç®—" â†’ "FY24_Budget"
- å…³è”é”®å‘ç°ï¼š"å‘˜å·¥ç¼–å·" â†” "å·¥å·"
- å€¼æ¨¡ç³ŠåŒ¹é…ï¼š"åŒ—äº¬" = "åŒ—äº¬å¸‚" = "Beijing"

#### 3. æ·±åº¦ä¸šåŠ¡ç†è§£
**å¤šæ™ºèƒ½ä½“åä½œæŒ–æ˜æ•°æ®èƒŒåçš„ä¸šåŠ¡é€»è¾‘**
- **ä¸šåŠ¡åˆ†ææ™ºèƒ½ä½“**: è¯†åˆ«ä¸šåŠ¡é¢†åŸŸã€å…³é”®ç»´åº¦å’Œæ ¸å¿ƒæŒ‡æ ‡
- **æ‰¹è¯„è€…æ™ºèƒ½ä½“**: è¯„ä¼°åˆ†æè´¨é‡ï¼Œå¤šè½®åä½œä¼˜åŒ–
- **è¯„åˆ¤æ™ºèƒ½ä½“**: éªŒè¯ç»“è®ºåˆç†æ€§å’Œæ•°æ®æ”¯æ’‘

### ğŸ¯ å…¶ä»–æ ¸å¿ƒåŠŸèƒ½
- **å¤šæ–‡æ¡£æ”¯æŒ**: åŒæ—¶å¤„ç†å¤šä¸ªExcelæ–‡æ¡£
- **å¤šè¡¨æ ¼æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«å•ä¸ªsheetä¸­çš„å¤šä¸ªè¡¨æ ¼
- **PRRæ¶æ„**: Plan-ReAct-Reflectæ™ºèƒ½è§„åˆ’æ‰§è¡Œæµç¨‹
- **é«˜çº§æŸ¥è¯¢**: è¿‡æ»¤ã€æ’åºã€å…³è”ã€èšåˆç­‰æ“ä½œ
- **è‡ªç„¶è¯­è¨€äº¤äº’**: æ”¯æŒå¤æ‚çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢

## æŠ€æœ¯æ ˆ (Tech Stack)

- **LangGraph**: æ™ºèƒ½ä½“å·¥ä½œæµæ¡†æ¶
- **LangChain**: LLMé›†æˆå’Œå·¥å…·è°ƒç”¨
- **Pandas**: æ•°æ®å¤„ç†å’Œåˆ†æ
- **OpenPyXL**: Excelæ–‡ä»¶è¯»å†™

## å®‰è£… (Installation)

```bash
git clone https://github.com/Heng-Bian/FiscalMind.git
cd FiscalMind
pip install -r requirements.txt
```

## å¿«é€Ÿå¼€å§‹ (Quick Start)

### æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œå¿«é€Ÿå¯åŠ¨

```bash
# å°†Excelæ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•
cp your_data.xlsx ./

# è¿è¡Œä¸»ç¨‹åºï¼ˆè‡ªåŠ¨åŠ è½½æ‰€æœ‰Excelæ–‡ä»¶å¹¶å¯åŠ¨æ™ºèƒ½åˆ†æï¼‰
python main.py
```

ç¨‹åºä¼šè‡ªåŠ¨å¯åŠ¨ PRR Agent è¿›è¡Œæ™ºèƒ½åˆ†æï¼Œè¿›å…¥äº¤äº’æ¨¡å¼ï¼š

```
FiscalMind> å“ªä¸ªå¤§åŒºè¡¨ç°æ›´å¥½ï¼Ÿ
æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜...

ä¸šåŠ¡åˆ†æï¼š
- ä¸šåŠ¡é¢†åŸŸ: è´¢åŠ¡
- å…³é”®ç»´åº¦: å¤§åŒº, æœˆä»½
- æ ¸å¿ƒæŒ‡æ ‡: é¢„ç®—, å®é™…, å·®é¢

åˆ†æç»“æœ: æ ¹æ®é”€å”®é¢å’Œåˆ©æ¶¦ç‡ç»¼åˆè¯„ä¼°ï¼Œåä¸œå¤§åŒºè¡¨ç°æœ€ä½³ã€‚
```

### æ–¹å¼äºŒï¼šPython API

```python
from fiscal_mind.prr_agent import PRRAgent
from langchain_openai import ChatOpenAI

# åˆ›å»ºå¸¦LLMçš„PRR Agent
llm = ChatOpenAI(model="gpt-4", temperature=0)
agent = PRRAgent(llm=llm)

# åŠ è½½æ–‡æ¡£å¹¶æŸ¥è¯¢
agent.load_documents(['financial_report.xlsx'])
answer = agent.query("å“ªä¸ªå¤§åŒºä»Šå¹´è¡¨ç°æ›´å¥½ï¼Ÿ")
print(answer)
```

### LLM é…ç½®è¯´æ˜

ç³»ç»Ÿæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š

**æœ‰ LLM æ¨¡å¼**ï¼ˆæ¨èï¼‰ï¼š
- å¯ç”¨æ™ºèƒ½è¡¨å¤´è¯†åˆ«ã€è¯­ä¹‰åŒ¹é…ã€ä¸šåŠ¡ç†è§£
- æä¾›ä¸“ä¸šçº§è´¢åŠ¡åˆ†æèƒ½åŠ›

**æ—  LLM æ¨¡å¼**ï¼š
- ä½¿ç”¨è§„åˆ™æ–¹æ³•å¤„ç†
- æä¾›åŸºç¡€æ•°æ®æŸ¥è¯¢åŠŸèƒ½

```python
# æ— LLMæ¨¡å¼
agent = PRRAgent(llm=None)
```


## æ ¸å¿ƒæ¨¡å— (Core Modules)

### Parser æ¨¡å— - æ™ºèƒ½è¡¨æ ¼è§£æ
**LLM é©±åŠ¨çš„è¡¨å¤´è¯†åˆ«å’Œå¤šè¡¨æ ¼æ£€æµ‹**

```python
from fiscal_mind.parser import ExcelParser

parser = ExcelParser()
doc = parser.load_document('report.xlsx')

# è‡ªåŠ¨æ£€æµ‹è¡¨å¤´ã€å¤šè¡¨æ ¼ã€åç§»ä½ç½®
summary = doc.get_document_summary()
```

### Semantic Resolver - è¯­ä¹‰åŒ¹é…å¼•æ“
**åŸºäº LLM çš„æ™ºèƒ½å­—æ®µåŒ¹é…**

```python
from fiscal_mind.semantic_resolver import SemanticResolver

resolver = SemanticResolver(llm=llm)
# è‡ªåŠ¨åŒ¹é…ä¸šåŠ¡è¯­ä¹‰ï¼š"è–ªèµ„" â†’ "æœˆè–ª"
columns = resolver.find_column_by_semantic(df, "è–ªèµ„")
```

### PRR Agent - æ™ºèƒ½åˆ†æå¼•æ“
**Plan-ReAct-Reflect æ¶æ„ + ä¸“ä¸šæ™ºèƒ½ä½“**

```python
from fiscal_mind.prr_agent import PRRAgent

agent = PRRAgent(llm=llm)
agent.load_documents(['data.xlsx'])

# è‡ªåŠ¨è§„åˆ’ã€æ‰§è¡Œã€åæ€ã€ä¸šåŠ¡ç†è§£
answer = agent.query("å“ªä¸ªå¤§åŒºä»Šå¹´è¡¨ç°æ›´å¥½ï¼Ÿ")
```

## ä½¿ç”¨ç¤ºä¾‹ (Usage Examples)

### ç¤ºä¾‹ 1: æ™ºèƒ½è¡¨å¤´è¯†åˆ«

```python
from fiscal_mind.parser import ExcelParser

parser = ExcelParser()
doc = parser.load_document('complex_table.xlsx')

# LLMè‡ªåŠ¨è¯†åˆ«è¡¨å¤´ä½ç½®ï¼Œå¤„ç†å¤šå±‚è¡¨å¤´å’Œåˆå¹¶å•å…ƒæ ¼
sheet = doc.get_sheet('æ•°æ®è¡¨')
print(sheet.columns)  # æ­£ç¡®è¯†åˆ«çš„è¡¨å¤´
```

### ç¤ºä¾‹ 2: è¯­ä¹‰å­—æ®µåŒ¹é…

```python
from fiscal_mind.semantic_resolver import SemanticResolver
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(model="gpt-4")
resolver = SemanticResolver(llm=llm)

# æ™ºèƒ½åŒ¹é…åˆ—å
df = doc.get_sheet('å‘˜å·¥è¡¨')
salary_cols = resolver.find_column_by_semantic(df, "è–ªèµ„")
# è¿”å›: ['æœˆè–ª', 'åŸºæœ¬å·¥èµ„', 'æ€»æ”¶å…¥'] ç­‰ç›¸å…³åˆ—
```

### ç¤ºä¾‹ 3: ä¸šåŠ¡ç†è§£ä¸åˆ†æ

```python
from fiscal_mind.prr_agent import PRRAgent
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(model="gpt-4", temperature=0)
agent = PRRAgent(llm=llm)

agent.load_documents(['regional_data.xlsx'])

# PRR Agentä¼šè‡ªåŠ¨ï¼š
# 1. ä¸šåŠ¡ç†è§£ - è¯†åˆ«è´¢åŠ¡é¢†åŸŸã€å…³é”®ç»´åº¦ã€æ ¸å¿ƒæŒ‡æ ‡
# 2. æ™ºèƒ½è§„åˆ’ - åˆ†è§£æŸ¥è¯¢ä¸ºæ‰§è¡Œæ­¥éª¤
# 3. æ¨ç†æ‰§è¡Œ - è°ƒç”¨å·¥å…·è·å–æ•°æ®
# 4. è´¨é‡è¯„åˆ¤ - éªŒè¯ç»“è®ºåˆç†æ€§
answer = agent.query("å¯¹æ¯”å„å¤§åŒºçš„é”€å”®é¢å’Œåˆ©æ¶¦ç‡ï¼Œæ‰¾å‡ºç»¼åˆè¡¨ç°æœ€å¥½çš„å¤§åŒº")
print(answer)
```

### ç¤ºä¾‹ 4: å¤šè¡¨æ ¼æ£€æµ‹

```python
# è‡ªåŠ¨æ£€æµ‹å•ä¸ªsheetä¸­çš„å¤šä¸ªè¡¨æ ¼
doc = parser.load_document('multi_table.xlsx')
summary = doc.get_sheet_summary('Sheet1')

print(f"æ£€æµ‹åˆ° {summary['num_tables']} ä¸ªè¡¨æ ¼")
for i in range(summary['num_tables']):
    table = doc.get_table_info('Sheet1', i)
    print(f"è¡¨æ ¼{i}: {table.description}")
```


## æ¶æ„è®¾è®¡ (Architecture)

### ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
ä¸šåŠ¡ç†è§£ï¼ˆå¤šæ™ºèƒ½ä½“åä½œï¼‰
    â”œâ”€â”€ è¯†åˆ«ä¸šåŠ¡é¢†åŸŸå’Œåœºæ™¯
    â”œâ”€â”€ æå–å…³é”®ç»´åº¦å’ŒæŒ‡æ ‡
    â””â”€â”€ è¯„ä¼°åˆ†æè´¨é‡
    â†“
æ™ºèƒ½è§„åˆ’ï¼ˆPRRï¼‰
    â”œâ”€â”€ åˆ†è§£æ‰§è¡Œæ­¥éª¤
    â””â”€â”€ èåˆä¸šåŠ¡ä¸Šä¸‹æ–‡
    â†“
æ¨ç†æ‰§è¡Œ
    â”œâ”€â”€ LLMè¯­ä¹‰åŒ¹é…ï¼ˆå­—æ®µ/å·¥ä½œè¡¨ï¼‰
    â”œâ”€â”€ LLMè¡¨å¤´è¯†åˆ«ï¼ˆå¤šå±‚/åç§»ï¼‰
    â””â”€â”€ æ•°æ®æå–å’Œèšåˆ
    â†“
è´¨é‡è¯„åˆ¤
    â”œâ”€â”€ éªŒè¯ç»“è®ºåˆç†æ€§
    â”œâ”€â”€ è¯„ä¼°æ•°æ®æ”¯æ’‘
    â””â”€â”€ ä¸šåŠ¡é€»è¾‘æ£€æŸ¥
    â†“
ç”Ÿæˆç­”æ¡ˆ
```

### æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹

1. **LLM è¡¨å¤´è¯†åˆ«**: è‡ªåŠ¨åŒºåˆ†è¡¨å¤´ä¸æ•°æ®ï¼Œå¤„ç†å¤æ‚æ ¼å¼
2. **LLM è¯­ä¹‰åŒ¹é…**: ç†è§£ä¸šåŠ¡å«ä¹‰ï¼Œæ™ºèƒ½åŒ¹é…å­—æ®µ
3. **LLM ä¸šåŠ¡ç†è§£**: å¤šæ™ºèƒ½ä½“æŒ–æ˜æ•°æ®èƒŒåçš„ä¸šåŠ¡é€»è¾‘
4. **PRR è‡ªä¸»è§„åˆ’**: è‡ªåŠ¨åˆ†è§£å¤æ‚æŸ¥è¯¢ï¼Œè¿­ä»£ä¼˜åŒ–

## æ‰©å±•å¼€å‘ (Extension)

### é›†æˆè‡ªå®šä¹‰ LLM

```python
from langchain_openai import ChatOpenAI

# ä½¿ç”¨ OpenAI
llm = ChatOpenAI(model="gpt-4", temperature=0)

# ä½¿ç”¨å…¶ä»–LLMæä¾›å•†
from langchain_anthropic import ChatAnthropic
llm = ChatAnthropic(model="claude-3-opus")

# åˆ›å»ºAgent
agent = PRRAgent(llm=llm)
```

## è´¡çŒ® (Contributing)

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯ (License)

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## è”ç³»æ–¹å¼ (Contact)

- é¡¹ç›®ä¸»é¡µ: https://github.com/Heng-Bian/FiscalMind
- Issueåé¦ˆ: https://github.com/Heng-Bian/FiscalMind/issues
