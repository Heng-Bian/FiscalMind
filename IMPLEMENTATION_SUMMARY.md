# FiscalMind 技术实现总结

## 核心技术架构

FiscalMind 是一个基于 LangGraph 框架的智能财务表格分析系统，通过深度集成大语言模型（LLM），实现了从数据解析到业务理解的全流程智能化。

## 关键技术特性

### 1. LLM驱动的智能表头识别

**技术亮点**：使用大语言模型准确识别表头结构，避免将数据行误判为表头

- **智能识别**：自动区分表头行与数据行，处理多层表头结构
- **上下文理解**：分析单元格内容、格式和位置，提供高置信度判断
- **自适应机制**：低置信度时自动回退到规则方法，确保稳定性

**实现位置**：`fiscal_mind/parser.py` - `TableDetector` 类

### 2. LLM增强的语义匹配

**技术亮点**：基于业务语义的智能字段名称匹配，而非简单的字符串比较

- **列名智能匹配**：理解业务含义，如"薪资" → "月薪"、"营收" → "销售额"
- **工作表语义匹配**：识别业务意图，如"24年预算" → "FY24_Budget"
- **关联键自动发现**：智能识别跨表关联，如"员工编号" ↔ "工号"
- **值模糊匹配**：支持多种表达方式，如"北京" = "北京市" = "Beijing"

**实现位置**：`fiscal_mind/semantic_resolver.py` - `SemanticResolver` 类

### 3. 专业智能体架构 - 深度业务理解

**技术亮点**：多智能体协作，从数据背后挖掘业务逻辑和洞察

#### 业务分析智能体
- 自动识别业务领域（财务、销售、人力等）
- 提取关键维度（区域、产品、时间等）
- 识别核心指标（销售额、利润率、效率等）
- 理解分析场景（绩效评估、预算对比等）

#### 批评者智能体
- 评估分析质量与问题匹配度（0-10分）
- 识别分析空白点和改进方向
- 多轮协作优化业务理解

#### 评判智能体
- 验证结论的业务逻辑合理性
- 评估数据支撑的充分性
- 提供质量评分和改进建议

**实现位置**：`fiscal_mind/specialized_agents.py`

### 4. Plan-ReAct-Reflect (PRR) 架构

**技术亮点**：自主规划、执行和反思的智能分析流程

```
用户查询 → 业务理解（LLM分析业务场景）
        → 智能规划（分解执行步骤）
        → 推理执行（调用工具获取数据）
        → 自我反思（评估进度调整策略）
        → 质量评判（验证结论合理性）
        → 生成答案
```

**优势**：
- 自动将复杂查询分解为可执行步骤
- 迭代优化直到获得满意结果
- 确保分析过程系统化和专业化

**实现位置**：`fiscal_mind/prr_agent.py`

### 5. 多表格智能检测

**技术特性**：
- 自动检测单个 sheet 中的多个表格
- 识别非标准位置的表格（不从A1开始）
- 提取表格周边的描述文本
- 处理复杂的合并单元格结构

**实现位置**：`fiscal_mind/parser.py` - `TableDetector` 类

## 技术栈

- **LangGraph**：智能体工作流框架
- **LangChain**：LLM 集成和工具调用
- **Pandas**：数据处理和分析
- **OpenPyXL**：Excel 文件解析

## LLM 集成架构

系统采用模块化设计，LLM 可选但强烈推荐：

- **无 LLM 模式**：使用规则方法，提供基础功能
- **有 LLM 模式**：启用智能表头识别、语义匹配和业务理解，提供专业级分析能力

## 核心优势

1. **智能化**：LLM 赋能全流程，从解析到理解
2. **专业性**：针对财务场景优化，理解业务逻辑
3. **自适应**：根据场景自动选择最佳策略
4. **可靠性**：多层保障机制，确保输出质量
